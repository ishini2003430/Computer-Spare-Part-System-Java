<%@ page import="java.sql.*" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Reports - TechParts</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f9fafb;
            margin: 0;
            padding: 2rem;
        }
        h1 {
            margin-bottom: 20px;
            color: #111827;
        }
        .metrics {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .metric-box {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgb(0 0 0 / 0.06);
            flex: 1;
            text-align: center;
        }
        .metric-box h2 {
            font-size: 2.5rem;
            margin: 0;
            color: #2563eb;
        }
        .metric-box p {
            margin-top: 0.5rem;
            font-weight: 600;
            color: #6b7280;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgb(0 0 0 / 0.06);
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background-color: #f3f4f6;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f1f5f9;
        }
        h2.section-title {
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #111827;
        }
    </style>
</head>
<body>

<h1>Reports Dashboard</h1>

<%
    // Initialize variables
    int totalSuppliers = 0;
    int totalParts = 0;
    int totalOrders = 0;
    double totalSalesAmount = 0.0;

    Connection conn = null;
    PreparedStatement ps = null;
    ResultSet rs = null;

    try {
        Class.forName("com.mysql.jdbc.Driver");
        conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/computer", "root", "ishini2003");

        // Total suppliers
        ps = conn.prepareStatement("SELECT COUNT(*) FROM suppliers");
        rs = ps.executeQuery();
        if (rs.next()) totalSuppliers = rs.getInt(1);
        rs.close();
        ps.close();

        // Total parts
        ps = conn.prepareStatement("SELECT COUNT(*) FROM parts");
        rs = ps.executeQuery();
        if (rs.next()) totalParts = rs.getInt(1);
        rs.close();
        ps.close();

        // Total orders
        ps = conn.prepareStatement("SELECT COUNT(*) FROM orders");
        rs = ps.executeQuery();
        if (rs.next()) totalOrders = rs.getInt(1);
        rs.close();
        ps.close();

        // Total sales amount (sum of total_amount from orders)
        ps = conn.prepareStatement("SELECT IFNULL(SUM(total_amount), 0) FROM orders");
        rs = ps.executeQuery();
        if (rs.next()) totalSalesAmount = rs.getDouble(1);
        rs.close();
        ps.close();

%>

<div class="metrics">
    <div class="metric-box">
        <h2><%= totalSuppliers %></h2>
        <p>Total Suppliers</p>
    </div>
    <div class="metric-box">
        <h2><%= totalParts %></h2>
        <p>Total Parts</p>
    </div>
    <div class="metric-box">
        <h2><%= totalOrders %></h2>
        <p>Total Orders</p>
    </div>
    <div class="metric-box">
        <h2>$<%= String.format("%.2f", totalSalesAmount) %></h2>
        <p>Total Sales Amount</p>
    </div>
</div>

<h2 class="section-title">Recent Suppliers</h2>
<table>
    <thead>
    <tr>
        <th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Company</th>
    </tr>
    </thead>
    <tbody>
    <%
        ps = conn.prepareStatement("SELECT id, name, email, phone, company FROM suppliers ORDER BY id DESC LIMIT 5");
        rs = ps.executeQuery();
        while (rs.next()) {
    %>
        <tr>
            <td><%= rs.getInt("id") %></td>
            <td><%= rs.getString("name") %></td>
            <td><%= rs.getString("email") %></td>
            <td><%= rs.getString("phone") %></td>
            <td><%= rs.getString("company") %></td>
        </tr>
    <%
        }
        rs.close();
        ps.close();
    %>
    </tbody>
</table>

<h2 class="section-title">Recent Orders</h2>
<table>
    <thead>
    <tr>
        <th>Order ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Total Amount</th><th>Date</th>
    </tr>
    </thead>
    <tbody>
    <%
        ps = conn.prepareStatement("SELECT id, name, email, phone, total_amount, created_at FROM orders ORDER BY created_at DESC LIMIT 5");
        rs = ps.executeQuery();
        while (rs.next()) {
    %>
        <tr>
            <td><%= rs.getInt("id") %></td>
            <td><%= rs.getString("name") %></td>
            <td><%= rs.getString("email") %></td>
            <td><%= rs.getString("phone") %></td>
            <td>$<%= String.format(\"%.2f\", rs.getDouble(\"total_amount\")) %></td>
            <td><%= rs.getTimestamp("created_at") %></td>
        </tr>
    <%
        }
        rs.close();
        ps.close();
        conn.close();
    } catch(Exception e) {
        out.println(\"<p style='color:red;'>Error: \" + e.getMessage() + \"</p>\");
    }
%>
    </tbody>
</table>

</body>
</html>
