<%@ page import="java.sql.*, java.util.*" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%
    String url = "jdbc:mysql://localhost:3306/computer";
    String user = "root";
    String pass = "ishini2003";

    String brand = request.getParameter("brand");
    String processor = request.getParameter("processor");
    String gpu = request.getParameter("gpu");
    String ram = request.getParameter("ram");
    String priceStr = request.getParameter("price");

    List<Map<String, String>> laptops = new ArrayList<>();

    try {
        Class.forName("com.mysql.cj.jdbc.Driver");
        Connection con = DriverManager.getConnection(url, user, pass);

        StringBuilder query = new StringBuilder("SELECT * FROM laptops WHERE 1=1");

        if (brand != null && !brand.isEmpty()) query.append(" AND brand='").append(brand).append("'");
        if (processor != null && !processor.isEmpty()) query.append(" AND processor='").append(processor).append("'");
        if (gpu != null && !gpu.isEmpty()) query.append(" AND gpu='").append(gpu).append("'");
        if (ram != null && !ram.isEmpty()) query.append(" AND ram='").append(ram).append("'");
        if (priceStr != null && !priceStr.isEmpty()) query.append(" AND price < ").append(priceStr);

        Statement st = con.createStatement();
        ResultSet rs = st.executeQuery(query.toString());

        while (rs.next()) {
            Map<String, String> laptop = new HashMap<>();
            laptop.put("name", rs.getString("name"));
            laptop.put("brand", rs.getString("brand"));
            laptop.put("processor", rs.getString("processor"));
            laptop.put("gpu", rs.getString("gpu"));
            laptop.put("ram", rs.getString("ram"));
            laptop.put("price", rs.getString("price"));
            laptop.put("image", rs.getString("image"));
            laptops.add(laptop);
        }

        rs.close();
        st.close();
        con.close();
    } catch (Exception e) {
        out.println("Database Error: " + e.getMessage());
    }
%>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>All Laptops</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
        }
        .container {
            max-width: 1300px;
            margin: 30px auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #1e293b;
            margin-bottom: 40px;
        }
        .filter-bar {
            background: white;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        .filter-bar select, .filter-bar input[type="range"] {
            padding: 10px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        .filter-bar button {
            padding: 10px 20px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .products {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .product-card {
            width: 260px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .product-card img {
            width: 100%;
            height: 170px;
            object-fit: contain;
            border-radius: 6px;
        }
        .product-title {
            font-weight: bold;
            margin: 10px 0;
        }
        .price {
            color: #e11d48;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>All Laptops</h1>

    <form class="filter-bar" method="get" action="laptop.jsp">
        <select name="brand">
            <option value="">All Brands</option>
            <option value="Apple">Apple</option>
            <option value="MSI">MSI</option>
            <option value="HP">HP</option>
            <option value="Acer">Acer</option>
            <option value="Asus">Asus</option>
            <option value="Dell">Dell</option>
            <option value="Lenevo">Lenevo</option>
        </select>
        <select name="processor">
            <option value="">All Processors</option>
             <option value="Intel i3">Intel i3</option>
            <option value="Intel i5">Intel i5</option>
            <option value="Intel i7">Intel i7</option>
            <option value="Apple M2">Apple M2</option>
             <option value="Apple M1">Apple M1</option>
              <option value="AMD Ryzen 3">AMD Ryzen 3</option>
               <option value="AMD Ryzen 5">AMD Ryzen 5</option>
                <option value="AMD Ryzen 7">AMD Ryzen 7</option>
        </select>
        <select name="gpu">
            <option value="">All GPUs</option>
            <option value="RTX 2050">RTX 2050</option>
            <option value="RTX 3070">RTX 3070</option>
            <option value="RTX 4050">RTX 4050</option>
            <option value="RTX 4060">RTX 4060</option>
            <option value="RTX 5050">RTX 5050</option>
            <option value="Apple GPU">Apple GPU</option>
        </select>
        <select name="ram">
            <option value="">All RAM</option>
            <option value="8GB">8 GB</option>
            <option value="16GB">16 GB</option>
        </select>
        <input type="range" name="price" min="100000" max="1000000" step="50000">
        <button type="submit">Filter</button>
    </form>

    <div class="products">
        <%
            for (Map<String, String> lap : laptops) {
        %>
        <div class="product-card">
            <img src="<%= lap.get("image") %>" alt="<%= lap.get("name") %>">
            <p class="product-title"><%= lap.get("name") %></p>
            <p><%= lap.get("processor") %> | <%= lap.get("ram") %> | <%= lap.get("gpu") %></p>
            <p class="price">Rs. <%= lap.get("price") %>.00</p>
        </div>
        <% } %>
    </div>
</div>
</body>
</html>
