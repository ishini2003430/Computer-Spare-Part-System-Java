package ComputerPackage;

import jakarta.servlet.*;

import java.io.IOException;
import java.util.*;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

@WebServlet("/RemoveFromCartServlet")
public class RemoveFromCartServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String idParam = request.getParameter("id");

        // Check if ID is not null or empty
        if (idParam != null && !idParam.trim().isEmpty() && !"null".equals(idParam)) {
            try {
                int id = Integer.parseInt(idParam);

                HttpSession session = request.getSession(false);
                if (session != null) {
                    List<HashMap<String, Object>> cart = (List<HashMap<String, Object>>) session.getAttribute("cart");

                    if (cart != null) {
                        cart.removeIf(item -> {
                            Object itemIdObj = item.get("id");
                            int itemId = 0;
                            try {
                                if (itemIdObj instanceof Integer) {
                                    itemId = (Integer) itemIdObj;
                                } else {
                                    itemId = Integer.parseInt(itemIdObj.toString());
                                }
                            } catch (Exception e) {
                                return false;
                            }
                            return itemId == id;
                        });

                        session.setAttribute("cart", cart);
                    }
                }
            } catch (NumberFormatException e) {
                System.out.println("Invalid ID format: " + idParam);
            }
        } else {
            System.out.println("ID parameter is null or invalid: " + idParam);
        }

        response.sendRedirect("ViewCart.jsp");
    }
}
